# Преобразование типов (явное и неявное)

В JavaScript преобразование типов (type coercion) — это процесс приведения одного типа данных к другому. Оно может быть
явным (когда вы сами указываете преобразование) или неявным (когда JavaScript автоматически преобразует типы).

## Неявное преобразование типов (Type Coercion)

Неявное преобразование происходит, когда JavaScript автоматически приводит один тип данных к другому в зависимости от
контекста операции. Это часто случается при использовании операторов, таких как `+`, `==` или в условиях.

### Примеры неявного преобразования:

#### Строковое преобразование:

Когда используется оператор `+` с одной строкой, другой операнд преобразуется в строку.

```js
let result = 5 + "15"; // "515" (число 5 преобразуется в строку)
```

#### Числовое преобразование:

Операторы, такие как `-`, `*`, `/`, преобразуют операнды в числа.

```js
let result = "10" - 5; // 5 (строка "10" преобразуется в число)
let value = "20" * 2; // 40 (строка "20" преобразуется в число)
```

#### Булево преобразование:

В логических операциях (например, условиях `if`) значения преобразуются в `true` или `false`.

Ложные значения (`falsy`): `0`, `""`, `null`, `undefined`, `NaN`, `false`.
Остальные значения — истинные (`truthy`).

```js
if ("hello") { // строка "hello" преобразуется в true
    console.log("Truthy");
}
```

#### Сравнение с `==`:

Оператор `==` (нестрогое сравнение) приводит типы перед сравнением:

```js
console.log(5 == "5"); // true (строка "5" преобразуется в число)
console.log(false == 0); // true (false преобразуется в 0)
```

##### Правила неявного преобразования:

**К числу:**

* Операторы `-`, `*`, `/`, `%`, `>` и другие, пытаются преобразовать операнды в числа.
* Используется внутренний метод `ToNumber`.
* Примеры:

```js
console.log("123" - 0); // 123
console.log("abc" - 0); // NaN (невозможно преобразовать в число
```

**К строке:**

* Оператор `+` приводит к строке, если хотя бы один операнд — строка.
* Используется внутренний метод `ToString`.

**К булеву значению:**

* В логическом контексте (условия, логические операторы) используется внутренний метод `ToBoolean`.

## Явное преобразование типов

Явное преобразование — это когда разработчик сам указывает, как преобразовать значение в нужный тип с помощью встроенных
функций или методов.

### Основные способы явного преобразования:

#### В число

* `Number()`

```js
let str = "123";
let num = Number(str); // 123 (number)
console.log(Number("abc")); // NaN
```

* `parseInt()` и `parseFloat()`

```js
console.log(parseInt("123.45")); // 123
console.log(parseFloat("123.45")); // 123.45
```

#### В строку

* `String()`

```js
let num = 42;
let str = String(num); // 42 (string)
```

* Метод `.toString()`

```js
let num = 42;
console.log(num.toString()); // 42 (string)
```

#### В булево значение

* `Boolean()`

```js
console.log(Boolean(0)); // false
console.log(Boolean("Hello")); // true
```

#### Унарный плюс (`+`)

* Преобразует строку в число

```js
let str = "123";
let num = +str; // 123 (number)
```

#### Двойное отрицание (`!!`)

* Преобразует значение в булево

```js
let value = "hello";
console.log(!!value); // true
```

#### Пример явного и неявного преобразования:

```js
let a = "100";
let b = 50;

// Неявное преобразование
console.log(a + b); // 10050 (число 50 преобразуется в строку)

// Явное преобразование
console.log(Number(a) + b); // 150 (строка 100 преобразуется в число)
```

### Проблемы и рекомендации

* **Неоднозначность:** Неявное преобразование может привести к ошибкам, например, `[] == 0` возвращает `true`, так как
  массив преобразуется в строку `""`, а затем в `0`.
* **Используйте ===:** Строгое сравнение предотвращает неявное преобразование.
* **Явное лучше неявного:** Если результат преобразования важен, лучше явно указать тип с помощью `Number()`, `String()`
  или `Boolean()`.
* **Осторожно с NaN:** При преобразовании некорректных данных в число часто получается `NaN`, что требует дополнительной
  проверки.

### Практический пример

```js
function calculateTotal(price, quantity) {
    // Явное преобразование для надежности
    const priceNumber = Number(price);
    const quantityNumber = Number(quantity);

    if (isNaN(priceNumber) || isNaN(quantityNumber)) {
        return "Invalid input";
    }

    return priceNumber * quantityNumber;
}


console.log(calculateTotal("100", "2")); // 200
console.log(calculateTotal("abc", "2.5")); // Invalid input
```

### Ключевые моменты

* Неявное преобразование происходит автоматически, но может быть непредсказуемым.
* Явное преобразование делает код более читаемым и предсказуемым.
* Используйте функции `Number()`, `String()`, `Boolean()`, `parseInt()`, `parseFloat()` для явного контроля типов.
* Избегайте оператора `==`, используйте `===` для строгого сравнения.